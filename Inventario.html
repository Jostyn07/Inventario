<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Inventario - Asesoras TH SAS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(17, 153, 142, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(235, 51, 73, 0.3);
        }

        .inventory-section {
            grid-column: 1 / -1;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .inventory-table thead {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
        }

        .inventory-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .inventory-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .inventory-table tbody tr:hover {
            background: #f8f9fa;
        }

        .stock-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
        }

        .stock-high {
            background: #d4edda;
            color: #155724;
        }

        .stock-medium {
            background: #fff3cd;
            color: #856404;
        }

        .stock-low {
            background: #f8d7da;
            color: #721c24;
        }

        .history-section {
            grid-column: 1 / -1;
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .history-item.recepcion {
            border-left-color: #38ef7d;
        }

        .history-item.entrega {
            border-left-color: #f45c43;
        }

        .history-item strong {
            color: #1e3c72;
        }

        .history-item .date {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9em;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .inventory-table {
                font-size: 0.9em;
            }

            .inventory-table th, .inventory-table td {
                padding: 10px;
            }
        }

        /* Modal de confirmaci√≥n */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            color: #721c24;
            margin-bottom: 20px;
            font-size: 1.5em;
            font-weight: 600;
        }

        .modal-body {
            margin-bottom: 25px;
            color: #333;
            line-height: 1.6;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì¶ Sistema de Inventario</h1>
            <p>ASESORAS TH SAS - NIT: 901612353</p>
            <p style="font-size: 0.95em; margin-top: 5px;">Gesti√≥n y control de equipos</p>
        </div>

        <div class="main-content">
            <!-- Secci√≥n de Recepci√≥n -->
            <div class="section">
                <h2>üì• Recibir Equipos</h2>
                <div id="alertRecepcion" class="alert"></div>
                <form id="formRecepcion">
                    <div class="form-group">
                        <label>Fecha de Recepci√≥n:</label>
                        <input type="date" id="fechaRecepcion" required>
                    </div>
                    <div class="form-group">
                        <label>Tipo de Equipo:</label>
                        <select id="tipoEquipoRecepcion" required>
                            <option value="">Seleccione...</option>
                            <option value="Diadema">Diadema</option>
                            <option value="Computador">Computador</option>
                            <option value="Mouse">Mouse</option>
                            <option value="Teclado">Teclado</option>
                            <option value="Monitor">Monitor</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>
                    <div class="form-group" id="otroEquipoRecepcionGroup" style="display: none;">
                        <label>Especifique el equipo:</label>
                        <input type="text" id="otroEquipoRecepcion" placeholder="Nombre del equipo">
                    </div>
                    <div class="form-group">
                        <label>Marca/Modelo:</label>
                        <input type="text" id="marcaRecepcion" placeholder="Ej: Logitech H340" required>
                    </div>
                    <div class="form-group">
                        <label>Cantidad:</label>
                        <input type="number" id="cantidadRecepcion" min="1" value="1" required>
                    </div>
                    <button type="submit" class="btn btn-success">‚úì Registrar Recepci√≥n</button>
                </form>
            </div>

            <!-- Secci√≥n de Entrega -->
            <div class="section">
                <h2>üì§ Entregar Equipos</h2>
                <div id="alertEntrega" class="alert"></div>
                <form id="formEntrega">
                    <div class="form-group">
                        <label>Fecha de Entrega:</label>
                        <input type="date" id="fechaEntrega" required>
                    </div>
                    <div class="form-group">
                        <label>Tipo de Equipo:</label>
                        <select id="tipoEquipoEntrega" required>
                            <option value="">Seleccione...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Marca/Modelo:</label>
                        <select id="marcaEntrega" required>
                            <option value="">Primero seleccione el tipo de equipo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Nombre del Colaborador:</label>
                        <input type="text" id="nombreColaborador" placeholder="Nombre completo" required>
                    </div>
                    <div class="form-group">
                        <label>C√©dula del Colaborador:</label>
                        <input type="text" id="cedulaColaborador" placeholder="N√∫mero de c√©dula" required>
                    </div>
                    <div class="form-group">
                        <label>Cantidad:</label>
                        <input type="number" id="cantidadEntrega" min="1" value="1" required>
                    </div>
                    <button type="submit" class="btn btn-danger">‚úì Registrar Entrega</button>
                </form>
            </div>

            <!-- Secci√≥n de Inventario Actual -->
            <div class="section inventory-section">
                <h2>üìä Inventario Actual</h2>
                <div class="stats" id="statsContainer"></div>
                <div class="btn-group" style="margin-bottom: 20px;">
                    <button onclick="exportarInventario()" class="btn btn-primary btn-small">üì• Exportar Inventario (Excel)</button>
                    <button onclick="exportarHistorial()" class="btn btn-primary btn-small">üì• Exportar Historial (Excel)</button>
                    <button onclick="exportarTodo()" class="btn btn-success btn-small">üì• Exportar Todo (Excel)</button>
                </div>
                <div style="overflow-x: auto;">
                    <table class="inventory-table">
                        <thead>
                            <tr>
                                <th>Tipo de Equipo</th>
                                <th>Marca/Modelo</th>
                                <th>Stock Disponible</th>
                                <th>Total Recibido</th>
                                <th>Total Entregado</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTableBody">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 30px; color: #999;">
                                    No hay equipos registrados. Registre una recepci√≥n para comenzar.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Historial de Movimientos -->
            <div class="section history-section">
                <h2>üìã Historial de Movimientos</h2>
                
                <!-- Controles del historial -->
                <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="font-size: 0.9em;">Fecha Inicio:</label>
                            <input type="date" id="fechaInicio" style="width: 100%; padding: 8px;">
                        </div>
                        <div>
                            <label style="font-size: 0.9em;">Fecha Fin:</label>
                            <input type="date" id="fechaFin" style="width: 100%; padding: 8px;">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                        <button onclick="filtrarHistorial()" class="btn btn-primary btn-small">üîç Filtrar por Fecha</button>
                        <button onclick="limpiarFiltros()" class="btn btn-primary btn-small">üîÑ Mostrar Todo</button>
                        <button onclick="confirmarLimpiarHistorial()" class="btn btn-danger btn-small">üóëÔ∏è Limpiar Historial</button>
                    </div>
                </div>
                
                <div id="historyContainer">
                    <p style="text-align: center; color: #999; padding: 20px;">
                        No hay movimientos registrados a√∫n.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n -->
    <div id="modalConfirmacion" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                ‚ö†Ô∏è Confirmar Acci√≥n
            </div>
            <div class="modal-body">
                <p><strong>¬øEst√° seguro que desea limpiar el historial de movimientos?</strong></p>
                <p>Esta acci√≥n eliminar√° todos los registros de recepciones y entregas.</p>
                <p style="color: #28a745; font-weight: 600;">‚úì El inventario actual se mantendr√° intacto.</p>
                <p style="color: #dc3545; font-weight: 600;">‚úó Esta acci√≥n no se puede deshacer.</p>
            </div>
            <div class="modal-footer">
                <button onclick="cerrarModal()" class="btn btn-primary btn-small">Cancelar</button>
                <button onclick="limpiarHistorial()" class="btn btn-danger btn-small">S√≠, Limpiar Historial</button>
            </div>
        </div>
    </div>

    <script>
        // Sistema de almacenamiento en memoria (se reinicia al recargar la p√°gina)
        let inventario = {};
        let historial = [];
        let historialFiltrado = [];
        let filtroActivo = false;

        // Cargar datos del localStorage al iniciar
        function cargarDatos() {
            const inventarioGuardado = localStorage.getItem('inventario');
            const historialGuardado = localStorage.getItem('historial');
            
            if (inventarioGuardado) {
                inventario = JSON.parse(inventarioGuardado);
            }
            if (historialGuardado) {
                historial = JSON.parse(historialGuardado);
            }
            
            actualizarInterfaz();
        }

        // Guardar datos en localStorage
        function guardarDatos() {
            localStorage.setItem('inventario', JSON.stringify(inventario));
            localStorage.setItem('historial', JSON.stringify(historial));
        }

        // Mostrar alerta
        function mostrarAlerta(elementId, mensaje, tipo) {
            const alert = document.getElementById(elementId);
            alert.className = `alert alert-${tipo} show`;
            alert.textContent = mensaje;
            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }

        // Manejar cambio de tipo de equipo en recepci√≥n
        document.getElementById('tipoEquipoRecepcion').addEventListener('change', function() {
            const otroGroup = document.getElementById('otroEquipoRecepcionGroup');
            if (this.value === 'Otro') {
                otroGroup.style.display = 'block';
                document.getElementById('otroEquipoRecepcion').required = true;
            } else {
                otroGroup.style.display = 'none';
                document.getElementById('otroEquipoRecepcion').required = false;
            }
        });

        // Manejar formulario de recepci√≥n
        document.getElementById('formRecepcion').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const fechaRecepcion = document.getElementById('fechaRecepcion').value;
            let tipoEquipo = document.getElementById('tipoEquipoRecepcion').value;
            if (tipoEquipo === 'Otro') {
                tipoEquipo = document.getElementById('otroEquipoRecepcion').value;
            }
            const marca = document.getElementById('marcaRecepcion').value;
            const cantidad = parseInt(document.getElementById('cantidadRecepcion').value);
            
            const key = `${tipoEquipo}|${marca}`;
            
            if (!inventario[key]) {
                inventario[key] = {
                    tipo: tipoEquipo,
                    marca: marca,
                    stockDisponible: 0,
                    totalRecibido: 0,
                    totalEntregado: 0
                };
            }
            
            inventario[key].stockDisponible += cantidad;
            inventario[key].totalRecibido += cantidad;
            
            // Formatear la fecha seleccionada
            const fechaObj = new Date(fechaRecepcion + 'T12:00:00');
            const fechaFormateada = fechaObj.toLocaleDateString('es-CO') + ', ' + new Date().toLocaleTimeString('es-CO');
            
            historial.unshift({
                tipo: 'recepcion',
                equipo: tipoEquipo,
                marca: marca,
                cantidad: cantidad,
                fecha: fechaFormateada,
                fechaRecepcion: fechaRecepcion
            });
            
            guardarDatos();
            actualizarInterfaz();
            this.reset();
            mostrarAlerta('alertRecepcion', `‚úì Se recibieron ${cantidad} unidad(es) de ${tipoEquipo} - ${marca}`, 'success');
        });

        // Actualizar opciones de tipo de equipo en entrega
        function actualizarOpcionesEntrega() {
            const selectTipo = document.getElementById('tipoEquipoEntrega');
            const selectMarca = document.getElementById('marcaEntrega');
            
            // Obtener tipos √∫nicos
            const tipos = new Set();
            Object.values(inventario).forEach(item => {
                if (item.stockDisponible > 0) {
                    tipos.add(item.tipo);
                }
            });
            
            selectTipo.innerHTML = '<option value="">Seleccione...</option>';
            tipos.forEach(tipo => {
                const option = document.createElement('option');
                option.value = tipo;
                option.textContent = tipo;
                selectTipo.appendChild(option);
            });
            
            selectMarca.innerHTML = '<option value="">Primero seleccione el tipo de equipo</option>';
        }

        // Manejar cambio de tipo de equipo en entrega
        document.getElementById('tipoEquipoEntrega').addEventListener('change', function() {
            const tipo = this.value;
            const selectMarca = document.getElementById('marcaEntrega');
            
            selectMarca.innerHTML = '<option value="">Seleccione...</option>';
            
            if (tipo) {
                Object.entries(inventario).forEach(([key, item]) => {
                    if (item.tipo === tipo && item.stockDisponible > 0) {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = `${item.marca} (Stock: ${item.stockDisponible})`;
                        selectMarca.appendChild(option);
                    }
                });
            }
        });

        // Manejar formulario de entrega
        document.getElementById('formEntrega').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const fechaEntrega = document.getElementById('fechaEntrega').value;
            const key = document.getElementById('marcaEntrega').value;
            const nombreColaborador = document.getElementById('nombreColaborador').value;
            const cedulaColaborador = document.getElementById('cedulaColaborador').value;
            const cantidad = parseInt(document.getElementById('cantidadEntrega').value);
            
            if (!key) {
                mostrarAlerta('alertEntrega', '‚ö† Por favor seleccione un equipo v√°lido', 'danger');
                return;
            }
            
            if (!inventario[key] || inventario[key].stockDisponible < cantidad) {
                mostrarAlerta('alertEntrega', `‚ö† No hay suficiente stock disponible. Stock actual: ${inventario[key]?.stockDisponible || 0}`, 'danger');
                return;
            }
            
            inventario[key].stockDisponible -= cantidad;
            inventario[key].totalEntregado += cantidad;
            
            // Formatear la fecha seleccionada
            const fechaObj = new Date(fechaEntrega + 'T12:00:00');
            const fechaFormateada = fechaObj.toLocaleDateString('es-CO') + ', ' + new Date().toLocaleTimeString('es-CO');
            
            historial.unshift({
                tipo: 'entrega',
                equipo: inventario[key].tipo,
                marca: inventario[key].marca,
                cantidad: cantidad,
                colaborador: nombreColaborador,
                cedula: cedulaColaborador,
                fecha: fechaFormateada,
                fechaEntrega: fechaEntrega
            });
            
            guardarDatos();
            actualizarInterfaz();
            this.reset();
            mostrarAlerta('alertEntrega', `‚úì Se entregaron ${cantidad} unidad(es) a ${nombreColaborador}`, 'success');
        });

        // Actualizar toda la interfaz
        function actualizarInterfaz() {
            actualizarTablaInventario();
            actualizarEstadisticas();
            actualizarHistorial();
            actualizarOpcionesEntrega();
        }

        // Actualizar tabla de inventario
        function actualizarTablaInventario() {
            const tbody = document.getElementById('inventoryTableBody');
            
            if (Object.keys(inventario).length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 30px; color: #999;">
                            No hay equipos registrados. Registre una recepci√≥n para comenzar.
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = '';
            
            Object.entries(inventario).forEach(([key, item]) => {
                const row = document.createElement('tr');
                
                let estadoClass = 'stock-low';
                let estadoTexto = 'Bajo';
                if (item.stockDisponible > 10) {
                    estadoClass = 'stock-high';
                    estadoTexto = '√ìptimo';
                } else if (item.stockDisponible > 5) {
                    estadoClass = 'stock-medium';
                    estadoTexto = 'Medio';
                }
                
                row.innerHTML = `
                    <td><strong>${item.tipo}</strong></td>
                    <td>${item.marca}</td>
                    <td><strong style="font-size: 1.2em; color: #667eea;">${item.stockDisponible}</strong></td>
                    <td>${item.totalRecibido}</td>
                    <td>${item.totalEntregado}</td>
                    <td><span class="stock-badge ${estadoClass}">${estadoTexto}</span></td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Actualizar estad√≠sticas
        function actualizarEstadisticas() {
            const container = document.getElementById('statsContainer');
            
            let totalEquipos = 0;
            let totalStock = 0;
            let totalEntregados = 0;
            
            Object.values(inventario).forEach(item => {
                totalEquipos++;
                totalStock += item.stockDisponible;
                totalEntregados += item.totalEntregado;
            });
            
            container.innerHTML = `
                <div class="stat-card">
                    <h3>${totalEquipos}</h3>
                    <p>Tipos de Equipos</p>
                </div>
                <div class="stat-card">
                    <h3>${totalStock}</h3>
                    <p>Stock Disponible</p>
                </div>
                <div class="stat-card">
                    <h3>${totalEntregados}</h3>
                    <p>Total Entregados</p>
                </div>
                <div class="stat-card">
                    <h3>${historial.length}</h3>
                    <p>Movimientos</p>
                </div>
            `;
        }

        // Actualizar historial
        function actualizarHistorial() {
            const container = document.getElementById('historyContainer');
            
            const historialMostrar = filtroActivo ? historialFiltrado : historial;
            
            if (historialMostrar.length === 0) {
                if (filtroActivo) {
                    container.innerHTML = `
                        <p style="text-align: center; color: #999; padding: 20px;">
                            No se encontraron movimientos en el rango de fechas seleccionado.
                        </p>
                    `;
                } else {
                    container.innerHTML = `
                        <p style="text-align: center; color: #999; padding: 20px;">
                            No hay movimientos registrados a√∫n.
                        </p>
                    `;
                }
                return;
            }
            
            container.innerHTML = '';
            
            historialMostrar.forEach(item => {
                const div = document.createElement('div');
                div.className = `history-item ${item.tipo}`;
                
                if (item.tipo === 'recepcion') {
                    div.innerHTML = `
                        <strong>üì• RECEPCI√ìN</strong><br>
                        ${item.cantidad} unidad(es) de <strong>${item.equipo}</strong> - ${item.marca}
                        <div class="date">${item.fecha}</div>
                    `;
                } else {
                    div.innerHTML = `
                        <strong>üì§ ENTREGA</strong><br>
                        ${item.cantidad} unidad(es) de <strong>${item.equipo}</strong> - ${item.marca}<br>
                        Colaborador: <strong>${item.colaborador}</strong> (CC: ${item.cedula})
                        <div class="date">${item.fecha}</div>
                    `;
                }
                
                container.appendChild(div);
            });
        }

        // Cargar datos al iniciar
        cargarDatos();
        
        // Establecer fecha actual por defecto en los formularios
        const fechaHoy = new Date().toISOString().split('T')[0];
        document.getElementById('fechaRecepcion').value = fechaHoy;
        document.getElementById('fechaEntrega').value = fechaHoy;

        // ========== FUNCIONES DE EXPORTACI√ìN ==========
        
        function exportarInventario() {
            if (Object.keys(inventario).length === 0) {
                alert('No hay datos de inventario para exportar.');
                return;
            }
            
            let csv = 'Tipo de Equipo,Marca/Modelo,Stock Disponible,Total Recibido,Total Entregado\n';
            
            Object.values(inventario).forEach(item => {
                csv += `"${item.tipo}","${item.marca}",${item.stockDisponible},${item.totalRecibido},${item.totalEntregado}\n`;
            });
            
            descargarCSV(csv, 'inventario_asesoras_th.csv');
        }
        
        function exportarHistorial() {
            if (historial.length === 0) {
                alert('No hay movimientos en el historial para exportar.');
                return;
            }
            
            let csv = 'Tipo,Fecha de Movimiento,Fecha Registrada,Equipo,Marca,Cantidad,Colaborador,C√©dula\n';
            
            historial.forEach(item => {
                const tipo = item.tipo === 'recepcion' ? 'RECEPCI√ìN' : 'ENTREGA';
                const colaborador = item.colaborador || '-';
                const cedula = item.cedula || '-';
                const fechaRegistrada = item.fechaRecepcion || item.fechaEntrega || '-';
                csv += `"${tipo}","${item.fecha}","${fechaRegistrada}","${item.equipo}","${item.marca}",${item.cantidad},"${colaborador}","${cedula}"\n`;
            });
            
            descargarCSV(csv, 'historial_movimientos_asesoras_th.csv');
        }
        
        function exportarTodo() {
            if (Object.keys(inventario).length === 0 && historial.length === 0) {
                alert('No hay datos para exportar.');
                return;
            }
            
            let csv = '===== INVENTARIO ACTUAL =====\n';
            csv += 'Tipo de Equipo,Marca/Modelo,Stock Disponible,Total Recibido,Total Entregado\n';
            
            Object.values(inventario).forEach(item => {
                csv += `"${item.tipo}","${item.marca}",${item.stockDisponible},${item.totalRecibido},${item.totalEntregado}\n`;
            });
            
            csv += '\n\n===== HISTORIAL DE MOVIMIENTOS =====\n';
            csv += 'Tipo,Fecha de Movimiento,Fecha Registrada,Equipo,Marca,Cantidad,Colaborador,C√©dula\n';
            
            historial.forEach(item => {
                const tipo = item.tipo === 'recepcion' ? 'RECEPCI√ìN' : 'ENTREGA';
                const colaborador = item.colaborador || '-';
                const cedula = item.cedula || '-';
                const fechaRegistrada = item.fechaRecepcion || item.fechaEntrega || '-';
                csv += `"${tipo}","${item.fecha}","${fechaRegistrada}","${item.equipo}","${item.marca}",${item.cantidad},"${colaborador}","${cedula}"\n`;
            });
            
            descargarCSV(csv, 'reporte_completo_asesoras_th.csv');
        }
        
        function descargarCSV(contenido, nombreArchivo) {
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + contenido], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', nombreArchivo);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('‚úì Archivo exportado exitosamente. Puede abrirlo con Excel.');
        }
        
        // ========== FUNCIONES DE FILTRADO ==========
        
        function filtrarHistorial() {
            const fechaInicio = document.getElementById('fechaInicio').value;
            const fechaFin = document.getElementById('fechaFin').value;
            
            if (!fechaInicio || !fechaFin) {
                alert('Por favor seleccione ambas fechas para filtrar.');
                return;
            }
            
            const inicio = new Date(fechaInicio + 'T00:00:00');
            const fin = new Date(fechaFin + 'T23:59:59');
            
            if (inicio > fin) {
                alert('La fecha de inicio no puede ser mayor a la fecha fin.');
                return;
            }
            
            historialFiltrado = historial.filter(item => {
                const fechaMovimiento = parsearFecha(item.fecha);
                return fechaMovimiento >= inicio && fechaMovimiento <= fin;
            });
            
            filtroActivo = true;
            actualizarHistorial();
            
            alert(`‚úì Se encontraron ${historialFiltrado.length} movimiento(s) en el rango seleccionado.`);
        }
        
        function parsearFecha(fechaStr) {
            // Formato esperado: "04/11/2025, 10:30:45 a. m." o similar
            const partes = fechaStr.split(',')[0].split('/');
            if (partes.length === 3) {
                const dia = parseInt(partes[0]);
                const mes = parseInt(partes[1]) - 1;
                const a√±o = parseInt(partes[2]);
                return new Date(a√±o, mes, dia);
            }
            return new Date(fechaStr);
        }
        
        function limpiarFiltros() {
            document.getElementById('fechaInicio').value = '';
            document.getElementById('fechaFin').value = '';
            filtroActivo = false;
            historialFiltrado = [];
            actualizarHistorial();
        }
        
        // ========== FUNCIONES DE LIMPIEZA DE HISTORIAL ==========
        
        function confirmarLimpiarHistorial() {
            if (historial.length === 0) {
                alert('No hay historial para limpiar.');
                return;
            }
            document.getElementById('modalConfirmacion').style.display = 'block';
        }
        
        function cerrarModal() {
            document.getElementById('modalConfirmacion').style.display = 'none';
        }
        
        function limpiarHistorial() {
            historial = [];
            historialFiltrado = [];
            filtroActivo = false;
            
            guardarDatos();
            actualizarInterfaz();
            cerrarModal();
            
            alert('‚úì El historial ha sido limpiado exitosamente.\nEl inventario actual se ha mantenido.');
        }
        
        // Cerrar modal al hacer clic fuera de √©l
        window.onclick = function(event) {
            const modal = document.getElementById('modalConfirmacion');
            if (event.target == modal) {
                cerrarModal();
            }
        }
    </script>
</body>
</html>